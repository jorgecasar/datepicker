<link rel="import" href="d-picker-day.html">
<link rel="import" href="d-picker-day-empty.html">
<dom-module id="d-picker-days">
  <template strip-whitespace>
    <style>
      :host {
        display: flex;
        flex-wrap: wrap;
      }
    </style>
  </template>
  <script>
    Polymer({
      is: "d-picker-days",
      properties: {
        date: Date,
        monthstr: String
      },
      attached: function() {
        this.addDays();
      },
      addStartEmptyDays: function(date) {
        for(let i = 0; i < date.getDay(); i++) {
          const old_date = this.addDaysToDate(
            date, -(date.getDay() - i)
          )
          this.addEmptyDays(old_date.getDate())
        }
      },
      addEndEmptyDays: function(date) {
        if(date.getDay() == 0) { return; }
        for(let i = 0; i <= 6 - date.getDay(); i++) {
          const next_date = this.addDaysToDate(date, i)
          this.addEmptyDays(next_date.getDate())
        }
      },
      addEmptyDays: function(number) {
        const empty = document.createElement("d-picker-day-empty");
        Polymer.dom(empty).setAttribute("number", number);
        Polymer.dom(this.root).appendChild(empty);
      },
      addDays: function() {
        const month = this.date.getMonth() + 1;
        const year = this.date.getFullYear();
        const firt_date = new Date(month + '/1/' + year);
        this.addStartEmptyDays(firt_date);
        let current_date = firt_date;
        let current_month = firt_date.getMonth();
        const now = new Date();
        while(current_month == firt_date.getMonth()) {
          const day = document.createElement("d-picker-day");
          Polymer.dom(day).setAttribute("number", current_date.getDate());
          Polymer.dom(day).setAttribute("month", current_date.getMonth());
          Polymer.dom(day).setAttribute("year", current_date.getFullYear());
          if(current_date.getMonth() == this.date.getMonth()
              && current_date.getDate() == this.date.getDate()
              && current_date.getFullYear() == this.date.getFullYear()) {
            $(day).css("background-color", "#f9f6b9");
          }
          Polymer.dom(this.root).appendChild(day);
          this.updateStyles();
          current_date = this.addDaysToDate(current_date, 1);
          current_month = current_date.getMonth();
        }
        this.addEndEmptyDays(current_date)
      },
      addDaysToDate: function(date, n) {
        var result = new Date(date);
        result.setDate(date.getDate() + n);
        return result;
      }
    });
  </script>
</dom-module>
