<link rel="import" href="../js/lib/polymer/polymer.html">
<link rel="import" href="d-picker-day.html">
<link rel="import" href="d-picker-day-empty.html">
<dom-module id="d-picker-days">
  <template strip-whitespace>
    <style>
      :host {
        display: flex;
        flex-wrap: wrap;
      }
    </style>
  </template>
  <script>
    Polymer({
      is: "d-picker-days",
      properties: {
        date: {
          type: Date
        }
      },
      attached: function() {
        this.addDays();
        this.setGotoAttr();
      },
      addEmptyDays: function(date) {
        for(let i = 0; i < date.getDay(); i++) {
          const empty = document.createElement("d-picker-day-empty");
          Polymer.dom(this.root).appendChild(empty);
        }
      },
      setGotoAttr: function() {
        const d = this.date;
        let goto_left  = d.getMonth() + '/1/' + d.getFullYear();
        let goto_right = (d.getMonth() + 2) + '/1/' + d.getFullYear();
        if(d.getMonth() == 0) {
          goto_left = '12/1/' + (d.getFullYear() - 1);
          goto_right = '2/1/' + d.getFullYear();
        } else if(d.getMonth() == 11) {
          goto_left = '11/1/' + d.getFullYear();
          goto_right = '1/1/' + (d.getFullYear() + 1);
        }
        Polymer.dom(this).setAttribute("goto_left", goto_left);
        Polymer.dom(this).setAttribute("goto_right", goto_right);
      },
      addDays: function() {
        const month = this.date.getMonth() + 1;
        const year = this.date.getFullYear();
        const firt_date = new Date(month + '/1/' + year);
        this.addEmptyDays(firt_date);
        let current_date = firt_date;
        let current_month = firt_date.getMonth();
        while(current_month == firt_date.getMonth()) {
          const day = document.createElement("d-picker-day");
          Polymer.dom(day).setAttribute("number", current_date.getDate());
          if(current_date.getDate() == this.date.getDate()) {
            $(day).css("background-color", "#ffd97d");
          }
          Polymer.dom(this.root).appendChild(day);
          this.updateStyles();
          current_date = this.incremetOneDay(current_date);
          current_month = current_date.getMonth();
        }
      },
      incremetOneDay: function(date) {
        var result = new Date(date);
        result.setDate(date.getDate() + 1);
        return result;
      }
    });
  </script>
</dom-module>
